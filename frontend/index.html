<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini åˆ©ç”¨è¦ç´„ãƒã‚§ãƒƒã‚«ãƒ¼</title>
    <style>
        :root {
            --bg-color: #242938; 
            --card-bg: #2f364a;
            --text-main: #e8eaed;
            --text-muted: #9aa0a6;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --border: #3d455c;
            --risk-high: #ef4444;
            --risk-med: #f59e0b;
            --risk-low: #10b981;
            --progress-size: 140px;
            --progress-bar-width: 10px;
            --circle-circumference: calc( (var(--progress-size) - var(--progress-bar-width) * 2) * 3.14159 );
        }

        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height: 1.6; color: var(--text-main); background-color: var(--bg-color); max-width: 800px; margin: 0 auto; padding: 20px; }
        h1 { color: #fff; text-align: center; margin-bottom: 30px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 10px; }

        .card { background-color: var(--card-bg); padding: 25px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        label { display: block; margin-bottom: 10px; color: var(--text-main); font-weight: 500; }
        
        #terms-url-input { width: 100%; padding: 14px; background-color: #1e2330; border: 1px solid var(--border); border-radius: 8px; color: #fff; font-size: 16px; box-sizing: border-box; transition: border-color 0.2s; }
        #terms-url-input:focus { outline: none; border-color: var(--accent); }

        #analyze-button { display: block; width: 100%; padding: 14px; background-color: var(--accent); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.2s; margin-top: 20px; }
        #analyze-button:hover { background-color: var(--accent-hover); }
        #analyze-button:disabled { background-color: #4b5563; cursor: not-allowed; opacity: 0.7; }

        #result-container { min-height: 100px; }
        hr { border: none; border-top: 1px solid var(--border); margin: 25px 0; }

        /* ã‚¬ã‚¤ãƒ‰ç”»é¢ã‚¹ã‚¿ã‚¤ãƒ« */
        .guide-section h3 { margin-top: 0; color: #fff; border-bottom: 2px solid var(--accent); display: inline-block; padding-bottom: 5px; margin-bottom: 15px; }
        .guide-steps { margin-bottom: 30px; padding-left: 20px; color: var(--text-muted); }
        .guide-steps li { margin-bottom: 8px; }
        
        .category-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        @media (max-width: 600px) { .category-grid { grid-template-columns: 1fr; } }

        .cat-card { background-color: rgba(255, 255, 255, 0.03); border: 1px solid var(--border); border-radius: 8px; padding: 15px; }
        .cat-card h4 { margin: 0 0 8px 0; color: var(--accent); font-size: 1em; }
        .cat-card p { margin: 0; font-size: 0.85em; color: var(--text-muted); line-height: 1.5; }

        /* è©•ä¾¡ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .evaluation-header { display: flex; align-items: center; margin-bottom: 15px; flex-wrap: wrap; }
        .evaluation-header h2 { margin: 0 15px 0 0; font-size: 1.5em; color: #fff; }
        
        .risk-badge { padding: 4px 12px; border-radius: 20px; color: #fff; font-weight: bold; font-size: 0.9em; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .risk-é«˜ { background-color: var(--risk-high); }
        .risk-ä¸­ { background-color: var(--risk-med); color: #000; }
        .risk-ä½ { background-color: var(--risk-low); }

        /* ãƒ‡ãƒ¢ãƒãƒƒã‚¸ */
        .demo-mode-badge {
            background-color: #6c757d; color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.5em; vertical-align: middle;
            display: none; 
        }

        .analysis-item { padding: 15px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 15px; background-color: rgba(255, 255, 255, 0.02); }
        .analysis-item.safe { border-left: 4px solid var(--risk-low); }
        .analysis-item.unsafe { border-left: 4px solid var(--risk-high); }

        details > summary { font-weight: bold; cursor: pointer; list-style: none; display: flex; align-items: center; color: var(--text-main); padding: 5px 0; }
        details > summary::-webkit-details-marker { display: none; }
        details > summary::before { content: 'â–¶'; margin-right: 10px; font-size: 0.8em; color: var(--text-muted); transition: transform 0.2s; }
        details[open] > summary::before { transform: rotate(90deg); }
        .details-content { padding-top: 15px; margin-top: 10px; border-top: 1px solid var(--border); color: var(--text-muted); }

        .issue-block { background-color: rgba(0, 0, 0, 0.2); padding: 15px; margin-top: 15px; border-radius: 6px; border-left: 3px solid #555; }
        .issue-block strong { color: #d1d5db; display: block; margin-bottom: 5px; font-size: 0.9em; }
        .issue-block blockquote { margin: 0 0 10px 0; padding: 8px; background-color: rgba(255, 255, 255, 0.05); color: #cbd5e1; font-style: italic; border-radius: 4px; }
        .issue-block p { margin: 0; color: #e8eaed; }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(20, 25, 35, 0.95); z-index: 9999; display: none; flex-direction: column; justify-content: center; align-items: center; backdrop-filter: blur(8px); }
        .progress-container { position: relative; width: var(--progress-size); height: var(--progress-size); margin-bottom: 20px; }
        .progress-ring { transform: rotate(-90deg); transform-origin: 50% 50%; }
        .progress-ring__circle-bg { fill: none; stroke: rgba(255, 255, 255, 0.1); stroke-width: var(--progress-bar-width); }
        .progress-ring__circle { fill: none; stroke: var(--accent); stroke-width: var(--progress-bar-width); stroke-linecap: round; stroke-dasharray: var(--circle-circumference); stroke-dashoffset: var(--circle-circumference); transition: stroke-dashoffset 0.5s ease-in-out; filter: drop-shadow(0 0 8px var(--accent)); }
        .progress-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5em; font-weight: bold; color: #fff; }
        .loading-message { color: #fff; font-size: 1.2em; font-weight: 500; letter-spacing: 0.5px; margin-bottom: 5px; text-align: center; }
        .loading-sub-message { color: var(--text-muted); font-size: 0.9em; text-align: center; }
    </style>
</head>
<body>
    <div id="loading-overlay">
        <div class="progress-container">
            <svg class="progress-ring" width="140" height="140">
                <circle class="progress-ring__circle-bg" stroke="white" stroke-width="10" fill="transparent" r="65" cx="70" cy="70"/>
                <circle class="progress-ring__circle" stroke="blue" stroke-width="10" fill="transparent" r="65" cx="70" cy="70"/>
            </svg>
            <div class="progress-text" id="progress-percent">0%</div>
        </div>
        <div>
            <div class="loading-message" id="loading-text">Initializing...</div>
            <div class="loading-sub-message">å‡¦ç†ã«ã¯1åˆ†ç¨‹åº¦ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™</div>
        </div>
    </div>

    <h1>ğŸ›¡ï¸ Gemini åˆ©ç”¨è¦ç´„ãƒã‚§ãƒƒã‚«ãƒ¼ <span id="demo-badge" class="demo-mode-badge">DEMO MODE</span></h1>
    
    <div class="card" id="terms-container">
        <label for="terms-url-input">åˆ†æã—ãŸã„åˆ©ç”¨è¦ç´„ã®URLã‚’å…¥åŠ›:</label>
        <input type="url" id="terms-url-input" placeholder="https://example.com/policy/terms">
        <button id="analyze-button">åˆ†æã‚’å®Ÿè¡Œ</button>
    </div>

    <div class="card" id="result-container">
        <div class="guide-section">
            <h3>ğŸ“ ä½¿ã„æ–¹ã¯ç°¡å˜ã§ã™</h3>
            <ol class="guide-steps">
                <li>åˆ†æã—ãŸã„åˆ©ç”¨è¦ç´„ãƒšãƒ¼ã‚¸ã®URLã‚’ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã—ã¾ã™ã€‚</li>
                <li>ã€Œåˆ†æã‚’å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚</li>
                <li>AIãŒæ¡æ–‡ã‚’èª­ã¿è¾¼ã¿ã€è‡ªå‹•çš„ã«ãƒªã‚¹ã‚¯ã‚’åˆ¤å®šã™ã‚‹ã®ã‚’å¾…ã¡ã¾ã™ã€‚</li>
            </ol>

            <h3>ğŸ” åˆ†æãƒ»è©•ä¾¡ã™ã‚‹6ã¤ã®ãƒã‚¤ãƒ³ãƒˆ</h3>
            <div class="category-grid">
                <div class="cat-card"><h4>1. å€‹äººæƒ…å ±ã®å–ã‚Šæ‰±ã„</h4><p>åé›†ãƒ‡ãƒ¼ã‚¿ã®ç›®çš„å¤–åˆ©ç”¨ã‚„ã€ç¬¬ä¸‰è€…æä¾›ã®ç¯„å›²ãŒä¸æ˜ç¢ºã§ãªã„ã‹ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚</p></div>
                <div class="cat-card"><h4>2. å…è²¬äº‹é …</h4><p>é‹å–¶å´ã®è²¬ä»»ã‚’éåº¦ã«å…é™¤ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¸å½“ãªä¸åˆ©ç›Šã‚’ä¸ãˆã‚‹æ¡é …ãŒãªã„ã‹ç¢ºèªã—ã¾ã™ã€‚</p></div>
                <div class="cat-card"><h4>3. è¦ç´„ã®å¤‰æ›´</h4><p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®äº‹å‰ã®é€šçŸ¥ãªãã€é‹å–¶å´ãŒå‹æ‰‹ã«ãƒ«ãƒ¼ãƒ«ã‚’å¤‰æ›´ã§ãã‚‹å±é™ºæ€§ãŒãªã„ã‹è¦‹ã¾ã™ã€‚</p></div>
                <div class="cat-card"><h4>4. ç¦æ­¢äº‹é …ã¨ãƒšãƒŠãƒ«ãƒ†ã‚£</h4><p>ç¦æ­¢è¡Œç‚ºã®å®šç¾©ãŒæ›–æ˜§ã ã£ãŸã‚Šã€é•åæ™‚ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåœæ­¢æªç½®ãªã©ãŒå³ã—ã™ããªã„ã‹è©•ä¾¡ã—ã¾ã™ã€‚</p></div>
                <div class="cat-card"><h4>5. çŸ¥çš„è²¡ç”£æ¨©</h4><p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠ•ç¨¿ã—ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ¨©åˆ©ï¼ˆè‘—ä½œæ¨©ãªã©ï¼‰ã‚’é‹å–¶å´ãŒä¸å½“ã«å¥ªã†æ¡é …ãŒãªã„ã‹æ¢ã—ã¾ã™ã€‚</p></div>
                <div class="cat-card"><h4>6. ãã®ä»–</h4><p>æº–æ‹ æ³•ã€è£åˆ¤ç®¡è½„ã€æœªæˆå¹´è€…ã®åˆ©ç”¨åˆ¶é™ãªã©ã€ãã®ä»–ã®æ³•çš„ãªãƒªã‚¹ã‚¯è¦å› ã‚’åˆ†æã—ã¾ã™ã€‚</p></div>
            </div>
        </div>
    </div>

    <script>
        const analyzeButton = document.getElementById('analyze-button');
        const urlInput = document.getElementById('terms-url-input');
        const resultContainer = document.getElementById('result-container');
        const loadingOverlay = document.getElementById('loading-overlay');
        const loadingText = document.getElementById('loading-text');
        const progressPercent = document.getElementById('progress-percent');
        const progressCircle = document.querySelector('.progress-ring__circle');
        const demoBadge = document.getElementById('demo-badge');

        const radius = 65;
        const circumference = radius * 2 * Math.PI;
        
        // ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ç®¡ç†ãƒ•ãƒ©ã‚°
        let isDemoMode = false;

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚µãƒ¼ãƒãƒ¼ã®çŠ¶æ…‹ã‚’ç¢ºèª
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('http://127.0.0.1:5000/status');
                const status = await response.json();
                
                if (status.is_demo) {
                    console.log("Running in Demo Mode");
                    isDemoMode = true;
                    

                    demoBadge.style.display = 'inline-block';
                    

                    if (status.default_url) {
                        urlInput.value = status.default_url;
                    }
                    

                    analyzeButton.textContent = 'ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã§åˆ†æã‚’å®Ÿè¡Œ';
                }
            } catch (e) {
                console.error("Status check failed:", e);
            }
        });

        function setProgress(percent) {
            const offset = circumference - (percent / 100 * circumference);
            progressCircle.style.strokeDashoffset = offset;
            progressPercent.textContent = `${percent}%`;
        }

        analyzeButton.addEventListener('click', async () => {
            const termsUrl = urlInput.value;
            if (!termsUrl.trim()) { alert('URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }

            analyzeButton.disabled = true;

            analyzeButton.textContent = 'åˆ†æä¸­...'; 
            
            loadingOverlay.style.display = 'flex';
            setProgress(0);
            
            const steps = [
                { msg: "ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ä¸­...", percent: 10 },
                { msg: "ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºãƒ»åˆ†å‰²ä¸­...", percent: 30 },
                { msg: "AIãŒæ¡é …ã‚’ä¸¦åˆ—åˆ†æä¸­...", percent: 50 },
                { msg: "åˆ†æçµæœã‚’çµ±åˆä¸­...", percent: 80 },
                { msg: "æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆä¸­...", percent: 90 }
            ];
            
            let currentStep = 0;
            loadingText.textContent = steps[0].msg;
            setProgress(steps[0].percent);

            const progressInterval = setInterval(() => {
                currentStep++;
                if (currentStep < steps.length) {
                    loadingText.textContent = steps[currentStep].msg;
                    setProgress(steps[currentStep].percent);
                }
            }, 3000); 

            try {
                const response = await fetch('http://127.0.0.1:5000/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ terms_url: termsUrl }),
                });

                const data = await response.json();
                
                if (!response.ok || data.error) {
                    throw new Error(data.error || 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
                }

                clearInterval(progressInterval);
                loadingText.textContent = "åˆ†æå®Œäº†ï¼";
                setProgress(100);
                
                setTimeout(() => {
                     displayResults(data);
                     loadingOverlay.style.display = 'none';
                }, 800);

            } catch (error) {
                clearInterval(progressInterval);
                loadingOverlay.style.display = 'none';
                resultContainer.innerHTML = `
                    <div style="color: var(--risk-high); text-align: center; padding: 20px;">
                        <h3 style="margin-top:0">âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                analyzeButton.disabled = false;
                // å‡¦ç†çµ‚äº†å¾Œã€ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ãªã‚‰ãƒœã‚¿ãƒ³ã®æ–‡å­—ã‚’å…ƒã«æˆ»ã™
                analyzeButton.textContent = isDemoMode ? 'ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã§åˆ†æã‚’å®Ÿè¡Œ' : 'åˆ†æã‚’å®Ÿè¡Œ';
            }
        });

        function displayResults(data) {
            let html = '';
            
            const demoBadgeHtml = data.is_demo ? '<span class="demo-mode-badge" style="display:inline-block; margin-left:10px;">ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºä¸­</span>' : '';

            if (data.overall_evaluation) {
                const eval = data.overall_evaluation;
                html += `
                    <div class="evaluation-header">
                        <h2>ç·åˆè©•ä¾¡</h2>
                        <span class="risk-badge risk-${eval.risk_level}">${eval.risk_level}</span>
                        ${demoBadgeHtml}
                    </div>
                    <p style="color: var(--text-main);">${eval.reason.replace(/\n/g, '<br>')}</p>
                    <hr>
                `;
            }
            if (data.detailed_analysis) {
                data.detailed_analysis.forEach(item => {
                    if (item.is_safe) {
                        html += `
                            <div class="analysis-item safe">
                                âœ… <strong>${item.category}</strong><br>
                                <span style="font-size: 0.9em; color: var(--text-muted);">ç‰¹ã«æ‡¸å¿µã•ã‚Œã‚‹ç‚¹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</span>
                            </div>`;
                    } else {
                        html += `
                            <details class="analysis-item unsafe">
                                <summary>âš ï¸ <strong>${item.category}</strong></summary>
                                <div class="details-content">
                                    <p style="margin-bottom: 15px;">${item.summary.replace(/\n/g, '<br>')}</p>
                        `;
                        (item.issues || []).forEach(issue => {
                            html += `
                                <div class="issue-block">
                                    <strong>è©²å½“æ¡æ–‡:</strong>
                                    <blockquote>${(issue.clause || '').replace(/\n/g, '<br>')}</blockquote>
                                    <strong>ãƒªã‚¹ã‚¯è§£èª¬:</strong>
                                    <p>${(issue.risk || '').replace(/\n/g, '<br>')}</p>
                                </div>
                            `;
                        });
                        html += `</div></details>`;
                    }
                });
            }
            resultContainer.innerHTML = html;
        }
    </script>
</body>
</html>